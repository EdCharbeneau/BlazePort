@page "/admin/Destinations"
@using BlazePort.Data
@using Microsoft.EntityFrameworkCore
@inject BlazePortContext dbContext

<a href="/admin/index">Admin Home</a>
<h3>Admin Destinations</h3>

<EditForm Model="newLocation" OnValidSubmit="@SaveLocation">

    <div class="form-group">
        <label>Name</label>
        <InputText @bind-Value="@newLocation.Name" Class="form-control" />
    </div>
    <div class="form-group">
        <label>Description</label>
        <InputTextArea @bind-Value="@newLocation.Description" Class="form-control" />
    </div>
    <div class="form-group">
        <label>Image URL</label>
        <InputText @bind-Value="@newLocation.ImageUrl" Class="form-control" />
    </div>
    <button>Save</button>
</EditForm>

<TelerikGrid Data="locations" Sortable="true" Pageable="true" Groupable="true"
            FilterMode="GridFilterMode.FilterRow">
    <GridColumns>
        <GridColumn Field="@nameof(LocationDetails.Name)" />
        <GridColumn Field="@nameof(LocationDetails.Description)" />
    </GridColumns>
</TelerikGrid>

@code {

    LocationDetails[] locations;

    LocationDetails newLocation = new LocationDetails();

    protected override async Task OnInitializedAsync()
    {
        await LoadLocations();
    }

    async Task LoadLocations()
    {
        locations = await dbContext.Locations.ToArrayAsync();
    }

    async Task SaveLocation()
    {
        dbContext.Locations.Add(newLocation);

        await dbContext.SaveChangesAsync();

        newLocation = new LocationDetails();

        await LoadLocations();
    }

}
